From 39d18a9ecf6bb79ce588764a67c66b5db2fea7a8 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Andreas=20M=C3=BCller?= <schnitzeltony@googlemail.com>
Date: Tue, 12 Jun 2012 12:51:04 +0200
Subject: [PATCH 2/2] omaplfb: Latest kernels can not be patched to support
 get/set_update_mode
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit


Signed-off-by: Andreas MÃ¼ller <schnitzeltony@googlemail.com>
---
 .../services4/3rdparty/dc_omapfb3_linux/omaplfb.h  |    2 ++
 .../3rdparty/dc_omapfb3_linux/omaplfb_linux.c      |    7 ++++++-
 2 files changed, 8 insertions(+), 1 deletions(-)

diff --git a/services4/3rdparty/dc_omapfb3_linux/omaplfb.h b/services4/3rdparty/dc_omapfb3_linux/omaplfb.h
index 881a49d..d823618 100755
--- a/services4/3rdparty/dc_omapfb3_linux/omaplfb.h
+++ b/services4/3rdparty/dc_omapfb3_linux/omaplfb.h
@@ -244,7 +244,9 @@ void OMAPLFBSwapHandler(OMAPLFB_BUFFER *psBuffer);
 void OMAPLFBQueueBufferForSwap(OMAPLFB_SWAPCHAIN *psSwapChain, OMAPLFB_BUFFER *psBuffer);
 void OMAPLFBFlip(OMAPLFB_DEVINFO *psDevInfo, OMAPLFB_BUFFER *psBuffer);
 OMAPLFB_UPDATE_MODE OMAPLFBGetUpdateMode(OMAPLFB_DEVINFO *psDevInfo);
+#if defined(PVR_OMAPFB3_UPDATE_MODE)
 OMAPLFB_BOOL OMAPLFBSetUpdateMode(OMAPLFB_DEVINFO *psDevInfo, OMAPLFB_UPDATE_MODE eMode);
+#endif
 OMAPLFB_BOOL OMAPLFBWaitForVSync(OMAPLFB_DEVINFO *psDevInfo);
 OMAPLFB_BOOL OMAPLFBManualSync(OMAPLFB_DEVINFO *psDevInfo);
 OMAPLFB_BOOL OMAPLFBCheckModeAndSync(OMAPLFB_DEVINFO *psDevInfo);
diff --git a/services4/3rdparty/dc_omapfb3_linux/omaplfb_linux.c b/services4/3rdparty/dc_omapfb3_linux/omaplfb_linux.c
index 248e964..f12d822 100755
--- a/services4/3rdparty/dc_omapfb3_linux/omaplfb_linux.c
+++ b/services4/3rdparty/dc_omapfb3_linux/omaplfb_linux.c
@@ -289,6 +289,7 @@ OMAPLFB_UPDATE_MODE OMAPLFBGetUpdateMode(OMAPLFB_DEVINFO *psDevInfo)
         {
 		DEBUG_PRINTK((KERN_INFO DRIVER_PREFIX ": %s: Device %u: No DSS device\n", __FUNCTION__, psDevInfo->uiFBDevID));
         }
+#if (LINUX_VERSION_CODE <= KERNEL_VERSION(3,3,0))
 	enum omap_dss_update_mode eMode;
 
 	if (psDSSDrv->get_update_mode == NULL)
@@ -313,9 +314,12 @@ OMAPLFB_UPDATE_MODE OMAPLFBGetUpdateMode(OMAPLFB_DEVINFO *psDevInfo)
 	}
 
 	return OMAPLFB_UPDATE_MODE_UNDEFINED;
-//return OMAPLFB_UPDATE_MODE_AUTO;
+#else
+	return OMAPLFB_UPDATE_MODE_AUTO;
+#endif
 }
 
+#if defined(PVR_OMAPFB3_UPDATE_MODE)
 OMAPLFB_BOOL OMAPLFBSetUpdateMode(OMAPLFB_DEVINFO *psDevInfo, OMAPLFB_UPDATE_MODE eMode)
 {
 	struct omap_dss_device *psDSSDev = fb2display(psDevInfo->psLINFBInfo);
@@ -354,6 +358,7 @@ OMAPLFB_BOOL OMAPLFBSetUpdateMode(OMAPLFB_DEVINFO *psDevInfo, OMAPLFB_UPDATE_MOD
 	return (res == 0);
 //return 1;
 }
+#endif
 
 OMAPLFB_BOOL OMAPLFBWaitForVSync(OMAPLFB_DEVINFO *psDevInfo)
 {
-- 
1.7.6.5

